<main class="main-container">
  <!-- Background decoration -->
  <div class="bg-decoration"></div>
  <div class="bg-grid"></div>

  <div class="app-wrapper">
    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <div class="logo">
          <svg
            width="32"
            height="32"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect width="32" height="32" rx="8" fill="currentColor" class="logo-bg" />
            <path
              d="M9 16.5L13.5 21L23 11"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <h1>Taskflow</h1>
        </div>
        <button
          class="theme-toggle"
          (click)="toggleTheme()"
          [attr.aria-label]="darkMode() ? 'Switch to light mode' : 'Switch to dark mode'"
        >
          @if (darkMode()) {
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="5" />
            <path
              d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
            />
          </svg>
          } @else {
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
          }
        </button>
      </div>
      <p class="tagline">Elegantly organize your day</p>
    </header>

    <!-- Input Section -->
    <div class="input-section">
      <form (ngSubmit)="addTodo()" class="todo-form">
        <div class="input-wrapper">
          <svg
            class="input-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 8v8M8 12h8" />
          </svg>
          <input
            type="text"
            [ngModel]="newTodoText()"
            (ngModelChange)="newTodoText.set($event)"
            [ngModelOptions]="{ standalone: true }"
            placeholder="What needs to be done?"
            class="todo-input"
          />
          <button type="submit" class="add-btn" [disabled]="!newTodoText().trim()">Add</button>
        </div>
      </form>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-section">
      <div class="filter-tabs">
        <button (click)="setFilter('all')" [class.active]="filter() === 'all'" class="filter-tab">
          All
          <span class="count">{{ todos().length }}</span>
        </button>
        <button
          (click)="setFilter('active')"
          [class.active]="filter() === 'active'"
          class="filter-tab"
        >
          Active
          <span class="count">{{ activeTodosCount() }}</span>
        </button>
        <button
          (click)="setFilter('completed')"
          [class.active]="filter() === 'completed'"
          class="filter-tab"
        >
          Completed
          <span class="count">{{ completedTodosCount() }}</span>
        </button>
      </div>
    </div>

    <!-- Todo List -->
    <div class="todo-list-container">
      @if (isLoading()) {
      <div class="empty-state">
        <svg
          class="loading-spinner"
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10" opacity="0.25" />
          <path d="M12 2a10 10 0 0 1 10 10" />
        </svg>
        <p>Loading tasks...</p>
      </div>
      } @else if (filteredTodos().length === 0) {
      <div class="empty-state">
        <svg
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2" />
          <rect x="9" y="3" width="6" height="4" rx="1" />
          <path d="M9 12h6M9 16h6" />
        </svg>
        <p>
          @if (filter() === 'all') { No tasks yet. Add one above! } @else if (filter() === 'active')
          { No active tasks. Great job! } @else { No completed tasks yet. }
        </p>
      </div>
      } @else {
      <ul class="todo-list">
        @for (todo of filteredTodos(); track todo.id) {
        <li
          class="todo-item"
          [class.completed]="todo.completed"
          [class.editing]="editingId() === todo.id"
        >
          @if (editingId() === todo.id) {
          <!-- Edit Mode -->
          <form (ngSubmit)="saveEdit(todo.id)" class="edit-form">
            <input
              type="text"
              [ngModel]="editText()"
              (ngModelChange)="editText.set($event)"
              [ngModelOptions]="{ standalone: true }"
              class="edit-input"
              (keydown.escape)="cancelEdit()"
              autofocus
            />
            <div class="edit-actions">
              <button type="submit" class="save-btn">Save</button>
              <button type="button" (click)="cancelEdit()" class="cancel-btn">Cancel</button>
            </div>
          </form>
          } @else {
          <!-- View Mode -->
          <button
            class="checkbox"
            (click)="toggleTodo(todo.id)"
            [attr.aria-label]="todo.completed ? 'Mark as incomplete' : 'Mark as complete'"
          >
            @if (todo.completed) {
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="3"
            >
              <path d="M5 12l5 5L20 7" />
            </svg>
            }
          </button>
          <span class="todo-text" (dblclick)="startEditing(todo)">{{ todo.text }}</span>
          <div class="todo-actions">
            <button class="edit-btn" (click)="startEditing(todo)" aria-label="Edit task">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" />
                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />
              </svg>
            </button>
            <button class="delete-btn" (click)="deleteTodo(todo.id)" aria-label="Delete task">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                />
              </svg>
            </button>
          </div>
          }
        </li>
        }
      </ul>
      }
    </div>

    <!-- Footer -->
    @if (completedTodosCount() > 0) {
    <div class="footer">
      <button class="clear-completed" (click)="clearCompleted()">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6" />
        </svg>
        Clear {{ completedTodosCount() }} completed
      </button>
    </div>
    }
  </div>
</main>
